{% extends 'base.html' %}

{% block extra_head %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<main class="dashboard-container">
    
    <header class="welcome-header fade-in-item">
        <h1>Ol√°, {{ request.user.username }}! üëã</h1>
        <p>Bem-vindo ao seu painel de torcedor. O que vamos fazer hoje?</p>
    </header>

    <section class="quick-actions-grid">
        
        <a href="{% url 'core:registrar_partida' %}" class="action-card card-destaque fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon">üèüÔ∏è</div>
                <h3>Registrar Nova Partida</h3>
                <p>Anote os detalhes do jogo que voc√™ assistiu.</p>
            </div>
        </a>
        
        <a href="{% url 'core:lista_partidas' %}" class="action-card fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon">üìä</div>
                <h3>Hist√≥rico de Jogos</h3>
                <p>Veja e avalie suas partidas anteriores.</p>
            </div>
        </a>

        <a href="{% url 'core:avaliacao_inicio' %}" class="action-card fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon">‚≠ê</div>
                <h3>Avaliar Est√°dio</h3>
                <p>Conte como foi sua experi√™ncia na arquibancada.</p>
            </div>
        </a>

        <a href="{% url 'core:galeria' %}" class="action-card fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon">üì∏</div>
                <h3>Galeria de M√≠dia</h3>
                <p>Reveja suas fotos e v√≠deos dos jogos.</p>
            </div>
        </a>
    </section>

    <section class="stats-panel fade-in-item">
        <h2>Suas Estat√≠sticas</h2>
        <div class="stats-grid">
            
            <div class="stat-item">
                <span class="stat-number" data-value="{{ partidas_registradas }}">0</span>
                <span class="stat-label">Partidas Registradas</span>
            </div>
            
            <div class="stat-item">
                <span class="stat-number" data-value="{{ estadios_avaliados }}">0</span>
                <span class="stat-label">Est√°dios Avaliados</span>
            </div>

            <div class="stat-item">
                {% if time_favorito %}
                    <span class="stat-number stat-team">{{ time_favorito }}</span>
                {% else %}
                    <span class="stat-number">--</span>
                {% endif %}
                <span class="stat-label">Seu Time do Cora√ß√£o</span>
            </div>

        </div>
    </section>

</main>

<style>
    /* --- Vari√°veis de Estilo --- */
    :root {
        --card-bg: #ffffff;
        --text-primary: #1d2d35;
        --text-secondary: #657786;
        --border-color: #e1e8ed;
        --shadow-color: rgba(0, 0, 0, 0.08);
        --destaque-color: #007bff;
        --destaque-hover: #0056b3;
    }

    .dashboard-container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 1rem;
        font-family: 'Poppins', sans-serif;
    }

    /* ================================
       FEATURE 1: ANIMA√á√ÉO EM CASCATA
       ================================
    */
    .fade-in-item {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }

    /* Classe 'is-visible' ser√° adicionada via JS */
    .fade-in-item.is-visible {
        opacity: 1;
        transform: translateY(0);
    }
    /* Fim da Anima√ß√£o em Cascata */


    /* 1. Cabe√ßalho de Boas-Vindas */
    .welcome-header {
        padding: 1.5rem 1rem;
        border-radius: 12px;
        background-color: var(--card-bg);
        box-shadow: 0 4px 15px var(--shadow-color);
        margin-bottom: 2rem;
    }
    .welcome-header h1 { margin: 0 0 0.25rem 0; color: var(--text-primary); font-size: 2rem; font-weight: 700; }
    .welcome-header p { margin: 0; color: var(--text-secondary); font-size: 1.1rem; }


    /* ================================
       FEATURE 3: EFEITO TILT 3D
       ================================
    */
    .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
        
        /* (JS) Define o "palco" 3D */
        perspective: 1000px;
    }

    .action-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        text-decoration: none;
        color: var(--text-primary);
        box-shadow: 0 4px 15px var(--shadow-color);
        border: 1px solid var(--border-color);
        
        /* (JS) Prepara o card para 3D e suaviza a transi√ß√£o de "sa√≠da" do mouse */
        transform-style: preserve-3d;
        transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), 
                    box-shadow 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .action-card:hover {
        /* (CSS) Sombra mais forte no hover (JS controlar√° o transform) */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    /* (JS) "Empurra" o conte√∫do para frente para dar profundidade */
    .card-content-wrapper {
        transform: translateZ(20px);
    }
    /* Fim do Efeito 3D */
    

    .card-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .action-card h3 { margin: 0 0 0.5rem 0; font-size: 1.2rem; font-weight: 600; }
    .action-card p { margin: 0; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.4; }

    /* Card de Destaque */
    .action-card.card-destaque {
        background-color: var(--destaque-color);
        color: white;
        border-color: var(--destaque-color);
    }
    .action-card.card-destaque h3 { color: white; }
    .action-card.card-destaque p { color: #e0e0e0; }
    .action-card.card-destaque:hover { background-color: var(--destaque-hover); }


    /* 3. Painel de Estat√≠sticas */
    .stats-panel {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px var(--shadow-color);
    }
    .stats-panel h2 { margin: 0 0 1.5rem 0; color: var(--text-primary); font-weight: 600; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
    .stat-item { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 1rem; background-color: #f9fafb; border-radius: 8px; }
    
    .stat-number {
        font-size: 2.25rem;
        font-weight: 700;
        color: var(--destaque-color);
        line-height: 1;
        
        /* (JS) Impede que o texto "pule" enquanto os n√∫meros mudam */
        font-variant-numeric: tabular-nums;
    }

    .stat-label { color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem; }
    .stat-team { font-size: 1.5rem; color: var(--text-primary); }

</style>


<script>
    // Executa tudo quando o DOM (HTML) estiver pronto
    document.addEventListener('DOMContentLoaded', () => {

        /* ================================
        FEATURE 1: ANIMA√á√ÉO EM CASCATA
        ================================
        */
        const animatedItems = document.querySelectorAll('.fade-in-item');
        
        animatedItems.forEach((item, index) => {
            // Adiciona a classe 'is-visible' com um atraso
            // O primeiro item (index 0) espera 100ms, o segundo 250ms, etc.
            setTimeout(() => {
                item.classList.add('is-visible');
            }, index * 150 + 100); // 150ms de atraso entre cada
        });


        /* ================================
        FEATURE 2: CONTADOR ANIMADO
        ================================
        */
        const counters = document.querySelectorAll('.stat-number[data-value]');
        const animationDuration = 1500; // Dura√ß√£o da anima√ß√£o em milissegundos

        const animateCounter = (counter) => {
            const targetValue = parseInt(counter.dataset.value, 10);
            if (isNaN(targetValue) || targetValue === 0) {
                counter.textContent = targetValue; // Define 0 se for 0 ou NaN
                return;
            }
            
            let startTime = null;

            const step = (timestamp) => {
                if (!startTime) startTime = timestamp;
                
                const progress = Math.min((timestamp - startTime) / animationDuration, 1);
                
                // Aplica 'easing' (desacelera√ß√£o) para um efeito suave
                const easeOutProgress = 1 - Math.pow(1 - progress, 3); // Ease-out cubc
                
                const currentValue = Math.floor(easeOutProgress * targetValue);
                
                counter.textContent = currentValue;
                
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                } else {
                    counter.textContent = targetValue; // Garante o valor final
                }
            };
            
            window.requestAnimationFrame(step);
        };

        counters.forEach(animateCounter);


        /* ================================
        FEATURE 3: EFEITO TILT 3D
        ================================
        */
        const tiltCards = document.querySelectorAll('.tilt-card');

        tiltCards.forEach(card => {
            const maxTilt = 15; // M√°ximo de inclina√ß√£o em graus

            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const cardWidth = card.offsetWidth;
                const cardHeight = card.offsetHeight;
                
                // Calcula a posi√ß√£o do mouse (de -0.5 a +0.5)
                const mouseX = (e.clientX - rect.left - cardWidth / 2) / (cardWidth / 2);
                const mouseY = (e.clientY - rect.top - cardHeight / 2) / (cardHeight / 2);
                
                // Calcula a rota√ß√£o (multiplica a posi√ß√£o pelo 'maxTilt')
                // Invertemos 'mouseY' para 'rotateX' para o efeito natural
                const rotateX = -maxTilt * mouseY;
                const rotateY = maxTilt * mouseX;
                
                // Aplica o transform com 'perspective'
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
            });

            card.addEventListener('mouseleave', () => {
                // Reseta a transforma√ß√£o quando o mouse sai
                card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1)';
            });
        });

    }); // Fim do DOMContentLoaded
</script>

{% endblock %}